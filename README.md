# RTU-Scripts

A small project to improve some hardware-software system by splitting of transfer data files and event files via different mobile communication transmission links.

The scripts are designed to run on LTE-router running OpenWRT operating system. Data files received on LAN from the measuring equipment are stored on an external drive connected to the router, and event files are transferred to the post-processing server.

## Scripts

- **ftp_config.sh**
IP address, username, password for FTP connection to the post-processing server

- **send_events_to_server.sh**
Transfer event files from the measuring equipment to the post-processing server

- **get_files_from_server.sh**
Receive the files from the post-processing server for the measuring equipment

- **bind_in_out.sh**
Bind directories IN and OUT on the external flash-drive to the root of the router's file system

- **check_wan_connection.sh**
Check WAN connection and reconnect if disconnected

- **check_vpn_connection.sh**
Check VPN connection and reconnect if disconnected

- **get_status_report.sh**
Ð¡ollect information about the current state of the router and generates a report file for subsequent transfer to the post-processing server

- **get_status_report_boot.sh**
Collect information about the current state of the router after boot

- **dirs_list.sh**
Get a list of directories and the number of files in them

- **send_status_to_server.sh**
Send the report file (generated by get_status_report.sh) to the post-processing server

## Installation

All scripts must be copied to /root/scripts on the router and have execute permission.

To add the execute permission:
```
# chmod +x /root/scripts/*.sh
```
Scripts are run by cron. To configure it, run the following command:
```
# crontab -e
```
An example of the contents of the file /etc/crontabs/root:
```
*/1 * * * *    /root/scripts/bind_in_out.sh
*/3 * * * *    /root/scripts/check_wan_connection.sh
*/5 * * * *    /root/scripts/check_vpn_connection.sh
*/3 * * * *    /root/scripts/send_events_to_server.sh
*/7 * * * *    /root/scripts/get_files_from_server.sh
*/5 * * * *    /root/scripts/send_status_to_server.sh
0 */3 * * *    /root/scripts/get_status_report.sh
```

To be able to generate a status report after the router is booted, add to the /etc/rc.local file:
```
/root/scripts/get_status_report_boot.sh &
exit 0
```

## OpenWRT packages

To support USB LTE-modem and flash-drive:
```
# opkg install comgt kmod-usb-uhci kmod-usb-serial kmod-usb-serial-option kmod-usb-serial-wwan usb-modeswitch usb-modeswitch-data
# opkg install blkid block-mount kmod-usb-storage kmod-fs-vfat kmod-nls-cp437 kmod-nls-cp1251 kmod-nls-cp866 kmod-nls-iso8859-1 kmod-nls-utf8
```
Installation FTP-server and FTP-client:
```
# opkg install vsftpd lftp
```
VPN support:
```
# opkg install ppp-mod-pptp kmod-nf-nathelper-extra
```
